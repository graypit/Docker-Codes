version: '3.1'

services:
    db:
        image: postgres:alpine 
        container_name: pgsql
        labels:
          NAME: "pgsql"
        network_mode: "host"
        restart: always
        volumes:
           - /root/procall/fs/pg_data:/var/lib/postgresql/data
        healthcheck:
          test: ["CMD-SHELL", "pg_isready -U postgres"]
          interval: 10s
          timeout: 5s
          retries: 10
        environment:
          - "DB_USER=fsuser"
          - "DB_PASSWORD=pr0c@lld@t@b@s3"
          - "DB_DATABASE=fsdb"
          - "POSTGRES_PASSWORD=str0ngp@ss"
        
    freeswitch:
       image: graypit/procall:latest
       container_name: freeswitch
       labels:
          NAME: "freeswitch"
       network_mode: "host"               
       restart: always
       healthcheck:
         test: ["CMD", "nc", "-z", "localhost", "8021"]
         interval: 10s
         timeout: 5s
         retries: 10
       depends_on:
          - db
       volumes:
          - '/root/procall/fs/conf:/etc/freeswitch/'
          - '/root/procall/fs/records:/var/lib/freeswitch/recordings/'
          - '/root/procall/fs/scripts:/usr/share/freeswitch/scripts/'
          - '/root/procall/fs/logs:/var/log/freeswitch/'
